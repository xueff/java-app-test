package worktest;

import io.vertx.core.json.JsonArray;
import io.vertx.core.json.JsonObject;
import javabase.ramdon.RamdonStudy;
import nsq.NsqClient;
import org.junit.Test;
import testmodel.EventModel;

import java.util.*;

public class NsqTest {
    @Test
    public void testAddSend(){
        EventModel e = new EventModel();
        try {
            long st = 1546099200000L;
            Double str = 3.0;
            Double water = 100000000.0;
            for(int i=0;i<40;i++) {
//                Thread.sleep(5);
                //if((st+(7*60*60*1000L)*i)>1547222399000L) break;
                JsonObject j = new JsonObject()
                        .put("hotelId", "bb545405-85b0-4243-873d-a52cfdf14cac")
                        .put("roomNo", "00"+i%3)
                        .put("timeStamp", st+(7*60*60*1000L)*i)
                        .put("value",water-0.1*i)
                        .put("type","WaterMeter");
                NsqClient.getInstance().produce("hydropower.meter", j.toString().getBytes());
                Thread.sleep(50);
                JsonObject j2 = new JsonObject()
                        .put("hotelId", "bb545405-85b0-4243-873d-a52cfdf14cac")
                        .put("roomNo", "00"+i%3)
                        .put("timeStamp", st+(7*60*60*1000L)*i)
                        .put("value",str+i*0.1)
                        .put("type","ElectricMeter");
                NsqClient.getInstance().produce("hydropower.meter", j2.toString().getBytes());
//            Long s = st+((6*60*1000L)*i);
//            Date d = new Date(s);
//            System.out.println(d.getYear()+"/"+d.getMonth()+"/"+d.getDay()+" "+d.getHours());
                if(i==20) Thread.sleep(2000);

            }

            System.out.println("OK");
        } catch (Exception e1) {
            e1.printStackTrace();
        }
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e1) {
            e1.printStackTrace();
        }
    }


    @Test
    public void testSend(){
        EventModel e = new EventModel();
        try {
            long st = System.currentTimeMillis();
            for(int i=0;i<2000;i++) {
                Thread.sleep(RamdonStudy.getRamdonInt(5));
                ThreadTest v = new ThreadTest();
                Thread t = new Thread(v);
                t.start();
//                NsqClient.getInstance().produce("xctrl.dc.receive1", getHearts().toString().getBytes());
            }
            System.out.println("time"+(System.currentTimeMillis()-st));
        } catch (Exception e1) {
            e1.printStackTrace();
        }
        try {
            Thread.sleep(100000000);
        } catch (InterruptedException e1) {
            e1.printStackTrace();
        }
    }

    public JsonArray getHearts(){
        List<byte[]> arr = new ArrayList();

        JsonArray arrjson = new JsonArray("\n" +
                "[{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000011\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152640,\"msgId\":\"f238b318-53b7-466f-a50d-2701c76ae2be\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000005\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000005\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151961,\"msgId\":\"6f06bb08-6d00-4e4d-984d-bc2661adda9d\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000001\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000001\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151821,\"msgId\":\"4c3d7a3a-4b10-4a5a-8811-eaf6d82dad46\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000001\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151827,\"msgId\":\"edce5699-909a-4cf3-99d3-79e1549a59fe\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000003\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151952,\"msgId\":\"00e90743-4dc8-4fcd-8100-f903b87faf3b\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000006\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152510,\"msgId\":\"6893153b-ff51-4100-ab66-cb0f9b83032b\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000012\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000012\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152644,\"msgId\":\"1efdda10-34d2-4077-a99a-0014254576dd\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000004\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000004\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151955,\"msgId\":\"b4d6c9b6-51ae-4eaf-bf0d-4240ebb65df4\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000008\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000008\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152526,\"msgId\":\"6384c140-8417-4f93-9424-44837e3f4f74\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000007\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000007\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152513,\"msgId\":\"19372644-8c92-487e-ba9d-ec88e4168450\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000012\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152710,\"msgId\":\"d9e794ac-ef67-4a29-8eee-6ff8acbc7f7e\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000004\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151958,\"msgId\":\"b2bd5aad-f411-4daa-bdcf-3cd789a37a94\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000002\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000002\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151833,\"msgId\":\"162f1239-a7e2-4fa9-bf55-b22f12e14a5e\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"主机\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Host\",\"version\":\"1.0.0\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151496,\"msgId\":\"7b2f0896-966a-4a86-b930-5bb8243c2410\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000013\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000013\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152712,\"msgId\":\"69e15292-9e30-40e2-a096-e6ee089d229c\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000010\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000010\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152626,\"msgId\":\"86d39a51-3d80-4744-a2fb-c65f32b4e94f\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000009\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000009\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152533,\"msgId\":\"bed114f1-20be-4e05-b52c-8d2bd1d1a08c\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000005\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152500,\"msgId\":\"8cebbde1-3552-4e9c-8c36-7d9bfe2b6f64\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000013\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152715,\"msgId\":\"b7e1ad96-d461-4975-bf4d-1c48c3ca44ce\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000006\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000006\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152506,\"msgId\":\"9fde95a7-829a-4647-bf4d-9f70f8e28551\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000003\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000003\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151899,\"msgId\":\"b3eff9ce-10a6-453b-a502-8123aebfab67\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000010\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152631,\"msgId\":\"08284ae1-1175-473f-974b-fcc0c7e6e1a2\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000011\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000011\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152637,\"msgId\":\"5f4e080b-c432-487a-8a51-f8c9bce3584b\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000002\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151838,\"msgId\":\"aa60709f-8241-4e84-8a87-f64d6ff4c4fb\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000009\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152599,\"msgId\":\"2605fbef-4a7c-4cfe-b410-862a651f766f\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000007\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152521,\"msgId\":\"f83b8507-ef5e-49d4-9516-9f90553a3048\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000008\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152529,\"msgId\":\"3399acad-f0e2-4bde-9bf9-7b52778c4a68\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151798,\"msgId\":\"06a50afe-5707-4774-9ab1-fab511452145\"}]");
//        long st0 = System.currentTimeMillis();
//        long st = System.currentTimeMillis();
//        Jedis jedis = JedisStudy.getInstance(8);
//        Pipeline pipe= jedis.pipelined();
//        for (int i = 0; i < arrjson.size(); i++) {
//            try {
//                pipe.set(arrjson.getJsonObject(i).getJsonObject("body").getString("path"),arrjson.getJsonObject(i).toString());
//            } catch (Exception e) {
//                e.printStackTrace();
//            }
//        }
//        pipe.sync();
//        jedis.close();
//        System.out.println("--zhu"+(System.currentTimeMillis()-st0));
       return arrjson;
    }
}

class ThreadTest implements Runnable{
        @Override
    public void run() {
        try {
            NsqTest t =  new NsqTest();
            for (;;) {
                NsqClient.getInstance().produce("xctrl.dc.receive1", t.getHearts().toString().getBytes());
                Thread.sleep(30000);
            }
//            List<byte[]> arr = new ArrayList();
//
//            JsonArray arrjson = new JsonArray("\n" +
//                    "[{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000011\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152640,\"msgId\":\"f238b318-53b7-466f-a50d-2701c76ae2be\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000005\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000005\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151961,\"msgId\":\"6f06bb08-6d00-4e4d-984d-bc2661adda9d\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000001\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000001\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151821,\"msgId\":\"4c3d7a3a-4b10-4a5a-8811-eaf6d82dad46\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000001\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151827,\"msgId\":\"edce5699-909a-4cf3-99d3-79e1549a59fe\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000003\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151952,\"msgId\":\"00e90743-4dc8-4fcd-8100-f903b87faf3b\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000006\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152510,\"msgId\":\"6893153b-ff51-4100-ab66-cb0f9b83032b\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000012\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000012\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152644,\"msgId\":\"1efdda10-34d2-4077-a99a-0014254576dd\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000004\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000004\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151955,\"msgId\":\"b4d6c9b6-51ae-4eaf-bf0d-4240ebb65df4\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000008\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000008\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152526,\"msgId\":\"6384c140-8417-4f93-9424-44837e3f4f74\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000007\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000007\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152513,\"msgId\":\"19372644-8c92-487e-ba9d-ec88e4168450\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000012\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152710,\"msgId\":\"d9e794ac-ef67-4a29-8eee-6ff8acbc7f7e\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000004\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151958,\"msgId\":\"b2bd5aad-f411-4daa-bdcf-3cd789a37a94\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000002\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000002\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151833,\"msgId\":\"162f1239-a7e2-4fa9-bf55-b22f12e14a5e\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"主机\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Host\",\"version\":\"1.0.0\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151496,\"msgId\":\"7b2f0896-966a-4a86-b930-5bb8243c2410\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000013\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000013\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152712,\"msgId\":\"69e15292-9e30-40e2-a096-e6ee089d229c\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000010\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000010\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152626,\"msgId\":\"86d39a51-3d80-4744-a2fb-c65f32b4e94f\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000009\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000009\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152533,\"msgId\":\"bed114f1-20be-4e05-b52c-8d2bd1d1a08c\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000005\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152500,\"msgId\":\"8cebbde1-3552-4e9c-8c36-7d9bfe2b6f64\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000013\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152715,\"msgId\":\"b7e1ad96-d461-4975-bf4d-1c48c3ca44ce\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000006\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000006\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152506,\"msgId\":\"9fde95a7-829a-4647-bf4d-9f70f8e28551\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000003\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000003\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029151899,\"msgId\":\"b3eff9ce-10a6-453b-a502-8123aebfab67\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000010\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152631,\"msgId\":\"08284ae1-1175-473f-974b-fcc0c7e6e1a2\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"CREATE\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000011\",\"fileData\":{\"type\":\"Device\",\"operateType\":\"ReadAndWrite\",\"visibleType\":\"Visible\",\"sceneType\":null,\"props\":{\"deviceInfo\":{\"deviceName\":\"灯\",\"deviceId\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000011\",\"host\":\"aaaaaaaa0000\",\"deviceType\":\"Light\",\"version\":\"VB1\",\"factory\":\"XZ\",\"trans\":\"HostTransform\",\"channelName\":\"TCPClientChannel\"},\"belong\":[\"8739326baa4f33c47c3a23f757d637c0.1820\"]}},\"msg\":null,\"msgId\":null},\"timeStamp\":1545029152637,\"msgId\":\"5f4e080b-c432-487a-8a51-f8c9bce3584b\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000002\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151838,\"msgId\":\"aa60709f-8241-4e84-8a87-f64d6ff4c4fb\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000009\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152599,\"msgId\":\"2605fbef-4a7c-4cfe-b410-862a651f766f\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000007\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152521,\"msgId\":\"f83b8507-ef5e-49d4-9516-9f90553a3048\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000@00124b000000000008\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029152529,\"msgId\":\"3399acad-f0e2-4bde-9bf9-7b52778c4a68\"},{\"type\":\"FILE\",\"header\":{\"EXTRATYPE\":\"EDITATTR\"},\"body\":{\"path\":\"/.dev/8739326baa4f33c47c3a23f757d637c0/aaaaaaaa0000\",\"attr\":{\"Heart\":1545029151329},\"msgId\":null},\"timeStamp\":1545029151798,\"msgId\":\"06a50afe-5707-4774-9ab1-fab511452145\"}]");
//            long st0 = System.currentTimeMillis();
//            Jedis jedis = JedisStudy.getInstance(8);
//            Pipeline pipe= jedis.pipelined();
//            for (int i = 0; i < arrjson.size(); i++) {
//                try {
//                    pipe.set(arrjson.getJsonObject(i).getJsonObject("body").getString("path"),arrjson.getJsonObject(i).toString());
//                } catch (Exception e) {
//                    e.printStackTrace();
//                }
//            }
//            pipe.sync();
//            jedis.close();
//            System.out.println("--zhu"+(System.currentTimeMillis()-st0));
        } catch (Exception e) {
            e.printStackTrace();
            //System.out.println("error:"+Thread.currentThread().getName()+":"+(System.currentTimeMillis()-st));
            return;
        }
        //System.out.println(Thread.currentThread().getName()+":"+(System.currentTimeMillis()-st));
    }
}


